{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///D:/Team%20Integration/%E5%85%89%E5%9C%88%E6%A3%B1%E9%95%9C-AperturePrism/Skills-AutoWebUI/src/app/api/save-skill/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport fs from 'fs';\nimport path from 'path';\nimport archiver from 'archiver';\n\nconst OUTPUT_DIR = path.join(process.cwd(), 'output');\n\nexport async function POST(request: Request) {\n  try {\n    const { filename, content } = await request.json();\n    \n    if (!fs.existsSync(OUTPUT_DIR)) {\n      fs.mkdirSync(OUTPUT_DIR, { recursive: true });\n    }\n\n    const safeFilename = path.basename(filename).replace(/[^a-zA-Z0-9._-]/g, '_');\n    const filePath = path.join(OUTPUT_DIR, safeFilename);\n\n    if (safeFilename.endsWith('.zip')) {\n      // Handle Zip creation for Trae\n      const skillName = safeFilename.replace('.zip', '');\n      const output = fs.createWriteStream(filePath);\n      const archive = archiver('zip', {\n        zlib: { level: 9 } // Sets the compression level.\n      });\n\n      // Good practice to catch warnings (ie stat failures and other non-blocking errors)\n      archive.on('warning', function(err) {\n        if (err.code === 'ENOENT') {\n          console.warn(err);\n        } else {\n          throw err;\n        }\n      });\n\n      // Good practice to catch this error explicitly\n      archive.on('error', function(err) {\n        throw err;\n      });\n\n      // Pipe archive data to the file\n      archive.pipe(output);\n\n      // append content from string, using a name like 'skill-name/SKILL.md'\n      // The user requested structure: skill-name/SKILL.md\n      archive.append(content, { name: `${skillName}/SKILL.md` });\n\n      // Finalize the archive (ie we are done appending files but streams have to finish yet)\n      await archive.finalize();\n\n      return new Promise((resolve, reject) => {\n        output.on('close', function() {\n          resolve(NextResponse.json({ success: true, path: filePath }));\n        });\n        output.on('error', function(err) {\n           console.error(\"Zip Write Error:\", err);\n           resolve(NextResponse.json({ error: 'Zip creation failed' }, { status: 500 }));\n        });\n      });\n\n    } else {\n      // Normal file save\n      fs.writeFileSync(filePath, content);\n      return NextResponse.json({ success: true, path: filePath });\n    }\n\n  } catch (error) {\n    console.error(\"Save Error:\", error);\n    return NextResponse.json({ error: 'Save failed' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAErC,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEhD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa;YAC9B,wGAAE,CAAC,SAAS,CAAC,YAAY;gBAAE,WAAW;YAAK;QAC7C;QAEA,MAAM,eAAe,4GAAI,CAAC,QAAQ,CAAC,UAAU,OAAO,CAAC,oBAAoB;QACzE,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;QAEvC,IAAI,aAAa,QAAQ,CAAC,SAAS;YACjC,+BAA+B;YAC/B,MAAM,YAAY,aAAa,OAAO,CAAC,QAAQ;YAC/C,MAAM,SAAS,wGAAE,CAAC,iBAAiB,CAAC;YACpC,MAAM,UAAU,IAAA,8IAAQ,EAAC,OAAO;gBAC9B,MAAM;oBAAE,OAAO;gBAAE,EAAE,8BAA8B;YACnD;YAEA,mFAAmF;YACnF,QAAQ,EAAE,CAAC,WAAW,SAAS,GAAG;gBAChC,IAAI,IAAI,IAAI,KAAK,UAAU;oBACzB,QAAQ,IAAI,CAAC;gBACf,OAAO;oBACL,MAAM;gBACR;YACF;YAEA,+CAA+C;YAC/C,QAAQ,EAAE,CAAC,SAAS,SAAS,GAAG;gBAC9B,MAAM;YACR;YAEA,gCAAgC;YAChC,QAAQ,IAAI,CAAC;YAEb,sEAAsE;YACtE,oDAAoD;YACpD,QAAQ,MAAM,CAAC,SAAS;gBAAE,MAAM,GAAG,UAAU,SAAS,CAAC;YAAC;YAExD,uFAAuF;YACvF,MAAM,QAAQ,QAAQ;YAEtB,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,OAAO,EAAE,CAAC,SAAS;oBACjB,QAAQ,gJAAY,CAAC,IAAI,CAAC;wBAAE,SAAS;wBAAM,MAAM;oBAAS;gBAC5D;gBACA,OAAO,EAAE,CAAC,SAAS,SAAS,GAAG;oBAC5B,QAAQ,KAAK,CAAC,oBAAoB;oBAClC,QAAQ,gJAAY,CAAC,IAAI,CAAC;wBAAE,OAAO;oBAAsB,GAAG;wBAAE,QAAQ;oBAAI;gBAC7E;YACF;QAEF,OAAO;YACL,mBAAmB;YACnB,wGAAE,CAAC,aAAa,CAAC,UAAU;YAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAM,MAAM;YAAS;QAC3D;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAc,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}