{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/Team%20Integration/%E5%85%89%E5%9C%88%E6%A3%B1%E9%95%9C-AperturePrism/Skills-AutoWebUI/src/lib/types.ts"],"sourcesContent":["export type ProviderType = \"openai\" | \"newapi\" | \"openwebui\" | \"custom\";\n\nexport interface Provider {\n  id: string;\n  name: string;\n  type: ProviderType;\n  baseUrl: string;\n  apiKey: string;\n  model: string;\n}\n\nexport interface Config {\n  providers: Provider[];\n  activeProvider: string | null;\n}\n\nexport type SupportedIDE = \"cursor\" | \"vscode\" | \"trae\" | \"windsurf\";\n\nexport const IDE_CONFIG: Record<SupportedIDE, { name: string; extension: string; format: \"markdown\" | \"json\" }> = {\n  cursor: { name: \"Cursor\", extension: \".mdc\", format: \"markdown\" },\n  vscode: { name: \"VS Code\", extension: \".code-snippets\", format: \"json\" },\n  trae: { name: \"Trae\", extension: \".zip\", format: \"markdown\" },\n  windsurf: { name: \"Windsurf\", extension: \".md\", format: \"markdown\" },\n};\n"],"names":[],"mappings":";;;;AAkBO,MAAM,aAAqG;IAChH,QAAQ;QAAE,MAAM;QAAU,WAAW;QAAQ,QAAQ;IAAW;IAChE,QAAQ;QAAE,MAAM;QAAW,WAAW;QAAkB,QAAQ;IAAO;IACvE,MAAM;QAAE,MAAM;QAAQ,WAAW;QAAQ,QAAQ;IAAW;IAC5D,UAAU;QAAE,MAAM;QAAY,WAAW;QAAO,QAAQ;IAAW;AACrE"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///D:/Team%20Integration/%E5%85%89%E5%9C%88%E6%A3%B1%E9%95%9C-AperturePrism/Skills-AutoWebUI/src/app/api/generate/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport fs from 'fs';\nimport path from 'path';\nimport { Config, SupportedIDE, IDE_CONFIG } from '@/lib/types';\n\nconst CONFIG_PATH = path.join(process.cwd(), 'data', 'config.json');\n\nexport async function POST(request: Request) {\n  try {\n    const { prompt, ide, skillName } = await request.json();\n    const targetIDE = (ide as SupportedIDE) || 'vscode';\n    const ideSettings = IDE_CONFIG[targetIDE];\n    const finalSkillName = skillName || \"Untitled Skill\";\n    \n    if (!fs.existsSync(CONFIG_PATH)) {\n      return NextResponse.json({ error: 'Config not found' }, { status: 400 });\n    }\n    \n    const config: Config = JSON.parse(fs.readFileSync(CONFIG_PATH, 'utf-8'));\n    const activeProvider = config.providers.find(p => p.id === config.activeProvider);\n    \n    if (!activeProvider) {\n      return NextResponse.json({ error: 'No active provider selected' }, { status: 400 });\n    }\n\n    const baseUrl = activeProvider.baseUrl.replace(/\\/$/, '');\n    const url = `${baseUrl}/chat/completions`;\n\n    // Construct a specific system prompt based on the target IDE\n    let systemPrompt = `You are an expert developer assistant specializing in creating configuration files and skills for IDEs.\n    The user wants to generate a skill/snippet for: ${ideSettings.name}.\n    Target format: ${ideSettings.format}.\n    \n    Requirements:\n    1. Return ONLY the raw code/content. Do not include markdown code blocks (like \\`\\`\\`) unless it's part of the file syntax itself (e.g. markdown file).\n    2. If the target is JSON (VS Code), ensure it is valid JSON with proper escaping.\n    3. If the target is Markdown (Cursor/Windsurf), ensure it follows best practices for that tool's system prompts/rules.\n    4. For Trae, generate a standard markdown skill file structure.\n    5. CRITICAL: Do NOT output any \"thinking process\" or content inside <think></think> tags. Only output the final result.\n    `;\n\n    if (targetIDE === 'vscode') {\n      systemPrompt += `\n      For VS Code, generate a valid JSON snippet file content. Example structure:\n      {\n        \"${finalSkillName}\": {\n          \"prefix\": \"...\",\n          \"body\": [\"line1\", \"line2\"],\n          \"description\": \"...\"\n        }\n      }`;\n    } else if (targetIDE === 'cursor') {\n       systemPrompt += `\n       For Cursor, generate a .mdc rule file. It should include frontmatter if applicable, or just clear markdown instructions that Cursor can index.`;\n    } else if (targetIDE === 'trae') {\n       systemPrompt += `\n       For Trae, generate a markdown skill file that MUST include a YAML frontmatter block at the top with 'name' and 'description'.\n       Use the following name: \"${finalSkillName}\"\n       Generate a concise but descriptive 'description' automatically based on the user's prompt.\n       \n       Example:\n       ---\n       name: ${finalSkillName}\n       description: [Your generated description here]\n       ---\n       \n       # Skill Content\n       ...\n       `;\n    }\n\n    const messages = [\n      { role: \"system\", content: systemPrompt },\n      { role: \"user\", content: prompt }\n    ];\n\n    console.log(`Calling ${url} with model ${activeProvider.model}`);\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${activeProvider.apiKey}`\n      },\n      body: JSON.stringify({\n        model: activeProvider.model,\n        messages: messages,\n      })\n    });\n\n    if (!response.ok) {\n        const errorText = await response.text();\n        console.error(\"Provider Error:\", errorText);\n        return NextResponse.json({ error: `Provider error: ${response.status} ${errorText}` }, { status: 500 });\n    }\n\n    const data = await response.json();\n    let content = data.choices[0].message.content;\n\n    // Filter out <think> tags (MiniMax-M2.1 specific)\n    content = content.replace(/<think>[\\s\\S]*?<\\/think>/g, '');\n\n    // Basic cleanup to remove code fences if the LLM added them despite instructions\n    // This is a simple heuristic; might need refinement.\n    if (content.startsWith('```') && content.endsWith('```')) {\n        const lines = content.split('\\n');\n        if (lines.length >= 2) {\n            content = lines.slice(1, -1).join('\\n');\n        }\n    } else if (content.startsWith('```json')) {\n        const lines = content.split('\\n');\n        content = lines.slice(1, -1).join('\\n');\n    }\n\n    return NextResponse.json({ content, extension: ideSettings.extension });\n\n  } catch (error) {\n    console.error(\"Generate Error:\", error);\n    return NextResponse.json({ error: 'Generation failed' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}