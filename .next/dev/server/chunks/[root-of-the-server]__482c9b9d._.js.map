{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/Team%20Integration/%E5%85%89%E5%9C%88%E6%A3%B1%E9%95%9C-AperturePrism/Skills-AutoWebUI/src/app/api/generate/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport fs from 'fs';\nimport path from 'path';\nimport { Config } from '@/lib/types';\n\nconst CONFIG_PATH = path.join(process.cwd(), 'data', 'config.json');\n\nexport async function POST(request: Request) {\n  try {\n    const { prompt } = await request.json();\n    \n    if (!fs.existsSync(CONFIG_PATH)) {\n      return NextResponse.json({ error: 'Config not found' }, { status: 400 });\n    }\n    \n    const config: Config = JSON.parse(fs.readFileSync(CONFIG_PATH, 'utf-8'));\n    const activeProvider = config.providers.find(p => p.id === config.activeProvider);\n    \n    if (!activeProvider) {\n      return NextResponse.json({ error: 'No active provider selected' }, { status: 400 });\n    }\n\n    // Ensure baseUrl doesn't end with slash to avoid double slash\n    const baseUrl = activeProvider.baseUrl.replace(/\\/$/, '');\n    // Simple heuristic: if it doesn't end in /v1, and it's openai/newapi, maybe warn or assume user knows.\n    // We will append /chat/completions\n    const url = `${baseUrl}/chat/completions`;\n\n    const messages = [\n      { role: \"system\", content: \"You are a helpful assistant that generates Skill files. Return only the code or content requested, minimal markdown wrapper.\" },\n      { role: \"user\", content: prompt }\n    ];\n\n    console.log(`Calling ${url} with model ${activeProvider.model}`);\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${activeProvider.apiKey}`\n      },\n      body: JSON.stringify({\n        model: activeProvider.model,\n        messages: messages,\n      })\n    });\n\n    if (!response.ok) {\n        const errorText = await response.text();\n        console.error(\"Provider Error:\", errorText);\n        return NextResponse.json({ error: `Provider error: ${response.status} ${errorText}` }, { status: 500 });\n    }\n\n    const data = await response.json();\n    const content = data.choices[0].message.content;\n\n    return NextResponse.json({ content });\n\n  } catch (error) {\n    console.error(\"Generate Error:\", error);\n    return NextResponse.json({ error: 'Generation failed' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAGA,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAE9C,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAErC,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,cAAc;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,SAAiB,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,aAAa;QAC/D,MAAM,iBAAiB,OAAO,SAAS,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,OAAO,cAAc;QAEhF,IAAI,CAAC,gBAAgB;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,8DAA8D;QAC9D,MAAM,UAAU,eAAe,OAAO,CAAC,OAAO,CAAC,OAAO;QACtD,uGAAuG;QACvG,mCAAmC;QACnC,MAAM,MAAM,GAAG,QAAQ,iBAAiB,CAAC;QAEzC,MAAM,WAAW;YACf;gBAAE,MAAM;gBAAU,SAAS;YAA+H;YAC1J;gBAAE,MAAM;gBAAQ,SAAS;YAAO;SACjC;QAED,QAAQ,GAAG,CAAC,CAAC,QAAQ,EAAE,IAAI,YAAY,EAAE,eAAe,KAAK,EAAE;QAE/D,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB,CAAC,OAAO,EAAE,eAAe,MAAM,EAAE;YACpD;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO,eAAe,KAAK;gBAC3B,UAAU;YACZ;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,mBAAmB;YACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,CAAC,gBAAgB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,WAAW;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACzG;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,UAAU,KAAK,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QAE/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IAErC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;AACF"}}]
}